<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能题目数据库管理系统</title>
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true,
                packages: ['base', 'ams', 'noerrors', 'noundefined']
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
            }
        };
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <div class="container">
        <!-- 状态栏 -->
        <div class="status-bar">
            <div class="status-left">
                <h1><i class="fas fa-graduation-cap"></i> 智能题目数据库管理系统</h1>
            </div>
            <div class="status-right">
                <div class="status-item">
                    <i class="fas fa-database"></i>
                    <span>题目总量: <strong id="total-questions">0</strong></span>
                </div>
                <div class="status-item">
                    <i class="fas fa-user"></i>
                    <span>用户: <strong id="current-username" style="cursor: pointer; color: #3498db;" onclick="window.location.href='/profile'">-</strong></span>
                </div>
                <div class="status-item cart-icon" id="cart-icon" title="生成试卷">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-badge" id="cart-badge">0</span>
                </div>
                <button class="btn-logout" id="logout-btn">
                    <i class="fas fa-sign-out-alt"></i> 登出
                </button>
            </div>
        </div>

        <!-- 导航标签 -->
        <nav class="nav-tabs">
            <button class="nav-tab active" data-tab="search">
                <i class="fas fa-search"></i> 查询题目
            </button>
            <button class="nav-tab" data-tab="add">
                <i class="fas fa-plus"></i> 录入题目
            </button>
            <button class="nav-tab" data-tab="ocr">
                <i class="fas fa-file-upload"></i> 试卷解析
            </button>
            <button class="nav-tab" data-tab="manage">
                <i class="fas fa-list"></i> 题目管理
            </button>
        </nav>

        <!-- 查询题目页面 -->
        <div id="search-tab" class="tab-content active">
            <div class="card">
                <h2><i class="fas fa-search"></i> 查询题目</h2>
                
                <!-- Google风格搜索框 -->
                <div class="google-search-container">
                    <div class="search-box-wrapper">
                        <div class="search-box">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" id="search-keyword" placeholder="搜索题目内容..." class="search-input">
                            <button id="search-btn" class="search-button">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- 标签筛选 -->
                    <div class="filter-section">
                        <h4><i class="fas fa-filter"></i> 按标签筛选</h4>
                        <div class="tag-filter" id="tag-filter">
                            <!-- 标签将通过JavaScript动态加载 -->
                        </div>
                    </div>
                </div>

                <div id="search-results" class="search-results">
                    <!-- 搜索结果将在这里显示 -->
                </div>
            </div>
        </div>

        <!-- 录入题目页面 -->
        <div id="add-tab" class="tab-content">
            <div class="card">
                <h2><i class="fas fa-edit"></i> 录入新题目</h2>
                
                <form id="question-form">
                    <div class="form-group">
                        <label for="latex-content">
                            <i class="fas fa-code"></i> 题目内容
                        </label>
                        <textarea id="latex-content" name="latex_content" rows="8" 
                                placeholder="请输入题目内容（支持普通文本或LaTeX格式）..."></textarea>
                        <div class="help-text">支持普通文本和LaTeX数学公式，系统会自动格式化为标准LaTeX格式</div>
                    </div>

                    <div class="form-group">
                        <label for="source">
                            <i class="fas fa-book"></i> 题目来源
                        </label>
                        <input type="text" id="source" name="source" 
                               placeholder="如：2023年高考数学全国卷I">
                    </div>

                    <div class="form-group">
                        <label>
                            <i class="fas fa-tags"></i> 题目标签
                        </label>
                        <div class="tag-selector" id="tag-selector">
                            <!-- 标签将通过JavaScript动态加载 -->
                        </div>
                    </div>

                    <div class="form-group">
                        <label>
                            <i class="fas fa-eye"></i> 可见范围
                        </label>
                        <div class="visibility-selector">
                            <label class="radio-item">
                                <input type="radio" name="visibility" value="public" checked>
                                <span><i class="fas fa-globe"></i> 所有人</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="visibility" value="private">
                                <span><i class="fas fa-lock"></i> 仅自己</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="image-upload">
                            <i class="fas fa-image"></i> 题目图片
                        </label>
                        <div class="image-upload-container">
                            <input type="file" id="image-upload" name="images" multiple accept="image/*" style="display: none;">
                            <button type="button" id="upload-btn" class="btn btn-secondary">
                                <i class="fas fa-upload"></i> 选择图片
                            </button>
                            <div id="image-preview" class="image-preview"></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="reference-answer">
                            <i class="fas fa-lightbulb"></i> 参考解答
                        </label>
                        <textarea id="reference-answer" name="reference_answer" rows="6" 
                                placeholder="请输入参考解答..."></textarea>
                    </div>

                    <div class="form-actions">
                        <button type="button" id="auto-tag-btn" class="btn btn-secondary">
                            <i class="fas fa-magic"></i> 自动打标、生成解答和LaTeX格式化
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> 保存题目
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- 试卷解析页面 -->
        <div id="ocr-tab" class="tab-content">
            <div class="card">
                <h2><i class="fas fa-file-upload"></i> 试卷解析</h2>
                
                <div class="form-group" style="margin-bottom: 20px;">
                    <label>
                        <i class="fas fa-eye"></i> 可见范围
                    </label>
                    <div class="visibility-selector">
                        <label class="radio-item">
                            <input type="radio" name="ocr-visibility" value="public" checked>
                            <span><i class="fas fa-globe"></i> 所有人</span>
                        </label>
                        <label class="radio-item">
                            <input type="radio" name="ocr-visibility" value="private">
                            <span><i class="fas fa-lock"></i> 仅自己</span>
                        </label>
                    </div>
                </div>

                <div class="ocr-upload-area">
                    <div class="upload-zone" id="upload-zone">
                        <div class="upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <h3>点击或拖拽上传试卷图片</h3>
                        <p>支持 PNG、JPG、JPEG 格式，最大 16MB</p>
                        <input type="file" id="exam-upload" accept="image/*" style="display: none;">
                        <button type="button" id="exam-upload-btn" class="btn btn-primary">
                            <i class="fas fa-upload"></i> 选择文件
                        </button>
                    </div>
                    
                    <div id="exam-preview" class="exam-preview" style="display: none;">
                        <div class="preview-header">
                            <h4><i class="fas fa-image"></i> 试卷预览</h4>
                            <button type="button" id="remove-exam-btn" class="btn btn-danger btn-sm">
                                <i class="fas fa-times"></i> 移除
                            </button>
                        </div>
                        <div class="preview-image"></div>
                        <button type="button" id="parse-exam-btn" class="btn btn-primary">
                            <i class="fas fa-cogs"></i> 开始解析
                        </button>
                    </div>
                </div>
                
                <!-- 解析结果 -->
                <div id="parsed-questions" class="parsed-questions" style="display: none;">
                    <div class="parsed-header">
                        <h4><i class="fas fa-list-alt"></i> 解析结果</h4>
                        <div class="parsed-stats">
                            共解析出 <span id="parsed-count">0</span> 道题目
                        </div>
                    </div>
                    <div id="parsed-questions-list" class="parsed-questions-list"></div>
                    <div class="parsed-actions">
                        <button type="button" id="batch-save-btn" class="btn btn-primary">
                            <i class="fas fa-save"></i> 批量保存到数据库
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 题目管理页面 -->
        <div id="manage-tab" class="tab-content">
            <div class="card">
                <div class="manage-header">
                    <h2><i class="fas fa-list"></i> 题目管理</h2>
                    <div class="manage-controls">
                        <button id="refresh-btn" class="btn btn-secondary">
                            <i class="fas fa-refresh"></i> 刷新
                        </button>
                        <div class="pagination-info">
                            显示 <span id="current-count">0</span> / <span id="total-count">0</span> 条记录
                        </div>
                    </div>
                </div>

                <div id="question-list" class="question-list">
                    <!-- 题目列表将在这里显示 -->
                </div>

                <div class="pagination">
                    <button id="prev-page" class="btn btn-secondary" disabled>
                        <i class="fas fa-chevron-left"></i> 上一页
                    </button>
                    <span id="page-info">第 1 页</span>
                    <button id="next-page" class="btn btn-secondary">
                        下一页 <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 题目详情模态框 -->
    <div id="question-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>题目详情</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div id="modal-question-content"></div>
                <div id="modal-question-tags"></div>
                <div id="modal-question-answer"></div>
            </div>
        </div>
    </div>

    <!-- 购物车/生成试卷模态框 -->
    <div id="cart-modal" class="modal">
        <div class="modal-content cart-modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-shopping-cart"></i> 生成试卷</h3>
                <button class="modal-close" id="cart-modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div id="cart-items" class="cart-items">
                    <!-- 购物车项目将在这里显示 -->
                </div>
                <div class="cart-actions">
                    <div class="export-options">
                        <h4>导出选项</h4>
                        <div class="form-group">
                            <label for="export-title">试卷标题</label>
                            <input type="text" id="export-title" class="export-input" value="数学试卷" placeholder="请输入试卷标题">
                        </div>
                        <div class="form-group">
                            <label>导出模式</label>
                            <div class="radio-group">
                                <label class="radio-item">
                                    <input type="radio" name="export-mode" value="questions" checked>
                                    <span>仅试题</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="export-mode" value="with-answers">
                                    <span>试题 + 解析答案</span>
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>导出格式</label>
                            <div class="radio-group">
                                <label class="radio-item">
                                    <input type="radio" name="export-format" value="latex" checked>
                                    <span>LaTeX</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="export-format" value="docx">
                                    <span>Word (DOCX)</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="export-format" value="pdf">
                                    <span>PDF</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="cart-buttons">
                        <button type="button" id="clear-cart-btn" class="btn btn-secondary">
                            <i class="fas fa-trash"></i> 清空
                        </button>
                        <button type="button" id="export-paper-btn" class="btn btn-primary">
                            <i class="fas fa-download"></i> 导出试卷
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 加载提示 -->
    <div id="loading" class="loading hidden">
        <div class="loading-spinner"></div>
        <p>处理中...</p>
    </div>

    <!-- 消息提示 -->
    <div id="message" class="message hidden">
        <span id="message-text"></span>
        <button id="message-close">&times;</button>
    </div>

    <script src="/static/script.js"></script>
</body>
</html>
